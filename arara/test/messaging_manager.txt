
Fake time

>>> import time
>>> def stub_time():
...     return 1.1
>>> org_time = time.time
>>> time.time = stub_time

Bootstrap test

>>> import arara
>>> server = arara.get_namespace()

Add user mikkang

>>> user_reg_dic = { 'id':'mikkang', 'password':'mikkang', 'nickname':'mikkang', 'email':'mikkang@sparcs.org', 'sig':'mikkang', 'self_introduce':'mikkang', 'default_language':'english' }
>>> ret, register_key = server.member_manager.register(user_reg_dic)
>>> ret
True
>>> server.member_manager.confirm('mikkang', register_key)
(True, 'OK')
>>> server.member_manager.is_registered('mikkang')
True
>>> ret, mikkang_session_key = server.login_manager.login('mikkang', 'mikkang', '143.248.234.145')
>>> ret
True

Add user serialx

>>> user_reg_dic = { 'id':'serialx', 'password':'serialx', 'nickname':'serialx', 'email':'serialx@serialx.net', 'sig':'serialx', 'self_introduce':'serialx', 'default_language':'english' }
>>> ret, register_key = server.member_manager.register(user_reg_dic)
>>> ret
True
>>> server.member_manager.confirm('serialx', register_key)
(True, 'OK')
>>> server.member_manager.is_registered('serialx')
True
>>> ret, serialx_session_key = server.login_manager.login('serialx', 'serialx', '143.248.234.140')
>>> ret
True

>>> server.messaging_manager.receive_list(mikkang_session_key)
(True, [])

>>> server.messaging_manager.send_message(serialx_session_key, 'mikkang', 'hello')
(True, 'OK')
>>> server.messaging_manager.receive_list(mikkang_session_key)
(True, [{'to': 'mikkang', 'message': 'hello', 'from': 'serialx', 'msg_no': 1, 'sent_time': '1970-01-01 09:00:01.100000'}])

>>> server.messaging_manager.send_message(serialx_session_key, 'mikkang', 'hello2')
(True, 'OK')
>>> server.messaging_manager.receive_list(mikkang_session_key)
(True, [{'to': 'mikkang', 'message': 'hello', 'from': 'serialx', 'msg_no': 1, 'sent_time': '1970-01-01 09:00:01.100000'}, {'to': 'mikkang', 'message': 'hello2', 'from': 'serialx', 'msg_no': 2, 'sent_time': '1970-01-01 09:00:01.100000'}])

>>> server.messaging_manager.read_message(mikkang_session_key, 1)
(True, {'to': 'mikkang', 'message': 'hello', 'from': 'serialx', 'msg_no': 1, 'sent_time': '1970-01-01 09:00:01.100000'})
>>> server.messaging_manager.read_message(mikkang_session_key, 2)
(True, {'to': 'mikkang', 'message': 'hello2', 'from': 'serialx', 'msg_no': 2, 'sent_time': '1970-01-01 09:00:01.100000'})

Test Errors

>>> server.messaging_manager.send_message('asdf', 'mikkang', 'hello')
(False, 'NOT_LOGGEDIN')
>>> server.messaging_manager.send_message(serialx_session_key, 'asdf', 'hello')
(False, 'USER_NOT_EXIST')
>>> server.messaging_manager.read_message(mikkang_session_key, 3)
(False, 'MSG_NOT_EXIST')
>>> server.messaging_manager.read_message('asdf', 2)
(False, 'NOT_LOGGEDIN')

>>> time.time = org_time
