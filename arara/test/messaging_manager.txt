
Fake time

>>> import time
>>> def stub_time():
...     return 1.1
>>> org_time = time.time
>>> time.time = stub_time

Bootstrap test

>>> import arara
>>> server = arara.get_namespace()

Login existing user mikkang

>>> server.member_manager.is_registered('mikkang')
True
>>> ret, mikkang_session_key = server.login_manager.login('mikkang', 'mikkang', '143.248.234.141')
>>> ret
True

Login existing user serialx

>>> ret, serialx_session_key = server.login_manager.login('serialx', 'serialx', '143.248.234.140')
>>> ret
True

>>> server.messaging_manager.receive_list(mikkang_session_key)
(True, [])

>>> server.messaging_manager.send_message(serialx_session_key, 'mikkang', 'hello')
(True, 'OK')
>>> server.messaging_manager.receive_list(mikkang_session_key)
(True, [{'from': u'serialx', 'sent_time': datetime.datetime(1970, 1, 1, 9, 0, 1, 100000), 'read_status': u'N', 'to': u'mikkang', 'message': u'hello', 'id': 1}])

>>> server.messaging_manager.send_message(serialx_session_key, 'mikkang', 'hello2')
(True, 'OK')
>>> server.messaging_manager.receive_list(mikkang_session_key)
(True, [{'from': u'serialx', 'sent_time': datetime.datetime(1970, 1, 1, 9, 0, 1, 100000), 'read_status': u'N', 'to': u'mikkang', 'message': u'hello2', 'id': 2}, {'from': u'serialx', 'sent_time': datetime.datetime(1970, 1, 1, 9, 0, 1, 100000), 'read_status': u'N', 'to': u'mikkang', 'message': u'hello', 'id': 1}])

>>> server.messaging_manager.sent_list(serialx_session_key)
(True, [{'from': u'serialx', 'sent_time': datetime.datetime(1970, 1, 1, 9, 0, 1, 100000), 'read_status': u'N', 'to': u'mikkang', 'message': u'hello2', 'id': 2}, {'from': u'serialx', 'sent_time': datetime.datetime(1970, 1, 1, 9, 0, 1, 100000), 'read_status': u'N', 'to': u'mikkang', 'message': u'hello', 'id': 1}])

>>> server.messaging_manager.sent_list(mikkang_session_key)
(True, [])

>>> server.messaging_manager.read_message(mikkang_session_key, 1)
(True, {'from': u'serialx', 'sent_time': datetime.datetime(1970, 1, 1, 9, 0, 1, 100000), 'read_status': u'N', 'to': u'mikkang', 'message': u'hello', 'id': 1})

>>> server.messaging_manager.read_message(mikkang_session_key, 2)
(True, {'from': u'serialx', 'sent_time': datetime.datetime(1970, 1, 1, 9, 0, 1, 100000), 'read_status': u'N', 'to': u'mikkang', 'message': u'hello2', 'id': 2})

Test Errors

>>> server.messaging_manager.send_message('asdf', 'mikkang', 'hello')
(False, 'NOT_LOGGEDIN')
>>> server.messaging_manager.send_message(serialx_session_key, 'asdf', 'hello')
(False, 'USER_NOT_EXIST')
>>> server.messaging_manager.read_message(mikkang_session_key, 3)
(False, 'MSG_NOT_EXIST')
>>> server.messaging_manager.read_message('asdf', 2)
(False, 'NOT_LOGGEDIN')

>>> time.time = org_time
