>>> import arara.model
>>> arara.model.init_test_database()
>>> import arara
>>> server = arara.get_namespace()

# Faking time.time (to check time field)

>>> import time
>>> def stub_time():
...     return 1.1
>>> org_time = time.time
>>> time.time = stub_time

>>> from arara.model import *

# Login as SYSOP and create 'garbage' board

>>> ret, session_key_sysop = server.login_manager.login('SYSOP', 'SYSOP', '123.123.123.123')
>>> ret
True

>>> server.board_manager.add_board(session_key_sysop, 'garbages', 'Garbage Board')
(True, 'OK')

# Register one user, serialx
>>> user_reg_dic = {'username':'serialx', 'password':'serialx', 'nickname':'serialx', 'email':'serialx', 'signature':'serialx', 'self_introduction':'serialx', 'default_language':'english' }
>>> ret, register_key = server.member_manager.register(user_reg_dic)
>>> ret
True
>>> server.member_manager.confirm('serialx', register_key)
(True, 'OK')
>>> ret, session_key_serialx = server.login_manager.login('serialx', 'serialx', '143.248.234.140')
>>> ret
True

>>> session = Session()
>>> board = session.query(Board).filter_by(board_name='garbages').one()
>>> serialx = session.query(User).filter_by(username='serialx').one()
>>> a = Article(board, 'title1', 'content', serialx, '0.0.0.0', None)
>>> b = Article(board, 'title2', 'content', serialx, '0.0.0.0', a)
>>> c = Article(board, 'title3', 'content', serialx, '0.0.0.0', b)
>>> d = Article(board, 'title4', 'content', serialx, '0.0.0.0', c)
>>> session.save(a)
>>> session.save(b)
>>> session.save(c)
>>> session.save(d)
>>> session.commit()
>>> d.root
<Article('title1', 'serialx', 1970-01-01 09:00:01.100000)>
>>> d.parent
<Article('title3', 'serialx', 1970-01-01 09:00:01.100000)>
>>> c.children
[<Article('title4', 'serialx', 1970-01-01 09:00:01.100000)>]
>>> a.descendants
[<Article('title2', 'serialx', 1970-01-01 09:00:01.100000)>, <Article('title3', 'serialx', 1970-01-01 09:00:01.100000)>, <Article('title4', 'serialx', 1970-01-01 09:00:01.100000)>]


>>> session = Session()
>>> a = session.query(Article).filter_by(title='title1').one()
>>> c = session.query(Article).filter_by(title='title3').one()
>>> d = session.query(Article).filter_by(title='title4').one()
>>> d.root
<Article('title1', 'serialx', 1970-01-01 09:00:01.100000)>
>>> d.parent
<Article('title3', 'serialx', 1970-01-01 09:00:01.100000)>
>>> c.children
[<Article('title4', 'serialx', 1970-01-01 09:00:01.100000)>]
>>> a.descendants
[<Article('title2', 'serialx', 1970-01-01 09:00:01.100000)>, <Article('title3', 'serialx', 1970-01-01 09:00:01.100000)>, <Article('title4', 'serialx', 1970-01-01 09:00:01.100000)>]


>>> time.time = org_time

# Reset the database
>>> import arara.model
>>> arara.model.clear_test_database()
