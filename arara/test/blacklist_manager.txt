>>> from arara_thrift.ttypes import *
>>> import arara.model
>>> arara.model.init_test_database()
>>> import arara
>>> server = arara.get_namespace()

# Register one user, combacsa. then login as existing user mikkang

>>> user_reg_dic = {'username':u'combacsa', 'password':u'combacsa', 'nickname':u'combacsa', 'email':u'combacsa@example.com', 'signature':u'combacsa', 'self_introduction':u'combacsa', 'default_language':u'english' }
>>> register_key = server.member_manager.register(UserRegistration(**user_reg_dic))
>>> server.member_manager.confirm(u'combacsa', register_key)
>>> session_key_combacsa = server.login_manager.login(u'combacsa', u'combacsa', '143.248.234.140')

# Register one user, mikkang

>>> user_reg_dic = {'username':u'mikkang', 'password':u'mikkang', 'nickname':u'mikkang', 'email':u'mikkang@example.com', 'signature':u'mikkang', 'self_introduction':u'mikkang', 'default_language':u'english' }
>>> register_key = server.member_manager.register(UserRegistration(**user_reg_dic))
>>> server.member_manager.confirm(u'mikkang', register_key)
>>> session_key = server.login_manager.login(u'mikkang', u'mikkang', '143.248.234.140')

# Register one user, serialx

>>> user_reg_dic = {'username':u'serialx', 'password':u'serialx', 'nickname':u'serialx', 'email':u'serialx@example.com', 'signature':u'serialx', 'self_introduction':u'serialx', 'default_language':u'english' }
>>> register_key = server.member_manager.register(UserRegistration(**user_reg_dic))
>>> server.member_manager.confirm(u'serialx', register_key)
>>> session_key_serialx = server.login_manager.login(u'serialx', u'serialx', u'143.248.234.140')

# Faking time.time (to check time field)

>>> import time
>>> def stub_time():
...     return 1.1
>>> org_time = time.time
>>> time.time = stub_time

now Test BlacklistManager!

>>> server.blacklist_manager.add(session_key, u'combacsa')
>>> server.blacklist_manager.add(session_key, u'pv457')
Traceback (most recent call last):
  ...
InvalidOperation
>>> server.blacklist_manager.add(session_key, u'combacsa')
Traceback (most recent call last):
  ...
InvalidOperation
>>> server.blacklist_manager.add(session_key, u'mikkang')
Traceback (most recent call last):
  ...
InvalidOperation
>>> ret = server.blacklist_manager.list_(session_key)
>>> [x.__dict__ for x in ret]
[{'blacklisted_user_nickname': u'combacsa', 'last_modified_date': 1.1000000000000001, 'block_article': True, 'blacklisted_user_username': u'combacsa', 'block_message': True, 'blacklisted_date': 1.1000000000000001, 'id': 1}]
>>> blacklist_dict = {'blacklisted_user_username': u'combacsa', 'block_article': 'False', 'block_message': 'True'}
>>> server.blacklist_manager.modify(session_key, BlacklistRequest(**blacklist_dict))
>>> ret = server.blacklist_manager.list_(session_key)
>>> [x.__dict__ for x in ret]
[{'blacklisted_user_nickname': u'combacsa', 'last_modified_date': 1.1000000000000001, 'block_article': True, 'blacklisted_user_username': u'combacsa', 'block_message': True, 'blacklisted_date': 1.1000000000000001, 'id': 1}]
>>> blacklist_dict = {'blacklisted_user_username': u'pv457', 'block_article': 'False', 'block_message': 'True'}
>>> server.blacklist_manager.modify(session_key, BlacklistRequest(**blacklist_dict))
Traceback (most recent call last):
  ...
InvalidOperation
>>> server.blacklist_manager.delete_(session_key, u'combacsa')
>>> blacklist_dict = {'blacklisted_user_username': u'combacsa', 'block_article': 'False', 'block_message': 'True'}
>>> server.blacklist_manager.modify(session_key, BlacklistRequest(**blacklist_dict))
Traceback (most recent call last):
  ...
InvalidOperation
>>> server.blacklist_manager.delete_(session_key, u'combacsa')
Traceback (most recent call last):
  ...
InvalidOperation
>>> server.blacklist_manager.delete_(session_key, u'pv457')
Traceback (most recent call last):
  ...
InvalidOperation
>>> server.login_manager.logout(session_key)

>>> time.time = org_time

# Reset the database
>>> import arara.model
>>> arara.model.clear_test_database()
